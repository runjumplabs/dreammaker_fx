<!doctype html>
<html lang="en">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link href="/static/style.css">

  <!-- add after bootstrap.min.css -->
  <link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/default.min.css">

  <link rel="stylesheet" href="/dreammaker_fx/assets/css/github-markdown.css">

  <title>Looper pedal with synth loop - DreamMakerFX</title>


  <style>
    .markdown-body {
      box-sizing: border-box;
      min-width: 200px;
      max-width: 980px;
      margin: 0 auto;
      padding: 45px;
    }

    nav[data-toggle="toc"] {
      top: 42px;
    }

    /* small screens */
    @media (max-width: 768px) {
      /* override stickyness so that the navigation does not follow scrolling */
      nav[data-toggle="toc"] {
        margin-bottom: 42px;
        position: static;
      }

      /* PICK ONE */
      /* don't expand nested items, which pushes down the rest of the page when navigating */
      /*
      nav[data-toggle="toc"] .nav .active .nav {
        display: none;
      }*/
      /* alternatively, if you *do* want the second-level navigation to be shown (as seen on this page on mobile), use this */
      
      nav[data-toggle='toc'] .nav .nav {
        display: block;
      }
      
    }

    h3 {
      border-bottom: 1px solid #ccc;
      padding-bottom: 10px;
    }

  </style>

</head>

<body data-spy="scroll" data-target="#toc">
 <nav>

</nav>


<div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm">
  <a href="/"><img src="/dreammaker_fx/assets/images/dfx_logo.png"></a>
  <h5 class="my-0 mr-md-auto font-weight-normal"></h5>
  <nav class="my-2 my-md-0 mr-md-3">

  
    <a class="p-2 text-dark" href="/dreammaker_fx/" >Home</a>
  
    <a class="p-2 text-dark" href="/dreammaker_fx/tutorial/" >Getting Started</a>
  
    <a class="p-2 text-dark" href="/dreammaker_fx/browse" >Browse Examples</a>
  
    <a class="p-2 text-dark" href="/dreammaker_fx/docs/" >API Docs</a>
  

  </nav>

</div>

 

 <div class="container">
  <h5>Looper pedal with synth loop </h3>
<ul>
<li>Created by: Dan </li>
<li>Minimum firmware ver: 1.0.0 </li>
<li>Description: This is a looper pedal which uses the fx send node to convert the instrument signal into a synth signal as it enters the loop so you're played over a synth version of the loop you just captured. </li>
</ul>
<strong>Arduino sketch</strong>
<pre><code class="cpp" style="arduino">#include "dm_fx.h"

/*
This is a basic looper pedal that sends the audio going into the loop through
a synth effect.

                +--------+
                |        |
                |        |
Instr In +----->+ Looper +----> Amp Out
                |        |
                |        |
                +-+----+-+
                  |    ^
                  v    |
                +-+----+-+
                | Synth  |
                +--------+

 
 */

fx_looper   loopy( 0.8,   // Dry mix
                   0.8,   // Looped audio mix
                   12,    // Max loop length in seconds
                   true); // Disable FX processing as audio enters the loop

fx_shaper    synth_sound(0.7,    // Clean mix
                         0.7,    // Shaper mix
                         0.2,    // Octave 1 mix
                         0.2);   // Octave 2 mix
                         

void setup() {
  
  // put your setup code here, to run once:
  pedal.init();

  // Pass audio through looper only
  pedal.route_audio(pedal.instr_in, loopy.input);
  pedal.route_audio(loopy.output, pedal.amp_out);

  // Patch FX of looper into the octave out of the synth
  pedal.route_audio(loopy.preproc_send, synth_sound.input);
  pedal.route_audio(synth_sound.oct_1_output, loopy.preproc_receive);


  // Optional code to print out the routing details to console
  if (true) {
    pedal.print_instance_stack();
    pedal.print_routing_table();
    pedal.print_param_tables();
  }
  
  // Run this effect
  pedal.run();

}
  
void loop() {

  // Add an event if pot 0 has changed
  if (pedal.pot_0.has_changed()) { 
  } 

  // Add an event if pot 0 has changed
  if (pedal.pot_1.has_changed()) { 
  } 

  #if 0
    // Add an event if pot 2 has changed (DOESN'T WORK ON FIRST GEN HARDWARE YET)
    if (pedal.pot_2.has_changed()) { 
    } 
  #endif   

  // Service 
  pedal.service();
}

// Footswitch 1 - typically used for enable/bypass
void footswitch_1_pressed() { 
  
  // Declared as static so state is preserved between calls
  static bool bypassed = false;

  // Bypass code
  if (bypassed) {
    // If we are currently bypassed, switch pedal to active mode and turn on LED next to SW1
    pedal.enable_fx();
    digitalWrite(PIN_FOOTSW_LED_1, HIGH); // Turn on LED
  } else {
    // If we are currently active, switch pedal to bypassed mode and turn off LED next to SW1
    pedal.bypass_fx();
    digitalWrite(PIN_FOOTSW_LED_1, LOW);  // Turn off LED
  }
  bypassed = !bypassed; // Toggle bypassed state variable
}

// Footswitch 2 - used to trigger loop
void footswitch_2_pressed() {

  static bool looping = false;

  if (!looping) {
    loopy.start_loop_recording();
    Serial.println("\nLoop recording");
    digitalWrite(PIN_FOOTSW_LED_2, HIGH); // Turn on LED
  } else {
    loopy.stop_loop_recording();
    Serial.println("\nLoop recording complete");
    digitalWrite(PIN_FOOTSW_LED_2, LOW); // Turn off LED
  }

  looping = !looping;
}

</code></pre>

</div>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>

<script>

  document.addEventListener('DOMContentLoaded', (event) => {
    document.querySelectorAll('pre code').forEach((block) => {
      hljs.highlightBlock(block);
    });
  });
</script>


</body>
</html>